{% extends 'base.html' %}
{% load static i18n gtsettings %}
{% load timejs %}
{% block title %}{% trans 'My reservations' %}{% endblock %}
{% block extra_css %}
  <link href="{% static 'css/checkBox.css' %}" rel="stylesheet">
{% endblock %}
{% block pre_head %}
    {% define_true 'use_datatables' as use_datatables %}
{% endblock %}
{% block content %}
    {% include 'laboratory/my_reservation_delete.html' %}
    {% include 'laboratory/my_reservation_delete_all.html' %}
    <div id="management_buttons">

        <label>Show all: </label>
        <label class="switch">
            <input id="showAllProducts" type="checkbox">
            <span class="slider round"></span>
        </label>

        <input data-bs-toggle="modal"
            data-bs-target="#delete_all_obj_reservation_modal" type="button"
            disabled="disabled" value="{% trans 'Cancel all selected products' %}" class="float-end btn btn-danger"
            id="cancel_all_products_btn">
        <input id="reserve_btn" class="float-end btn btn-success" data-id="{{labpk}}" type="button" onclick="make_reservation()" disabled="disabled" value='{% trans "Reserve" %}'>
    </div>

    <table id="table_id" class="display table table-striped table-bordered"></table>

{% endblock %}
{% block js %}
    <script>
        document.get_lab_id_script_url = '{% url "laboratory:get_lab_id"%}';
        document.api_modal_delete = '{% url "laboratory:api_reservation_delete" 0%}';
        document.api_create_reservation = '{% url "laboratory:api_individual_reservation_create"%}';
        document.api_update_product = '{% url "laboratory:api_reservation_update" 0%}';
        document.api_get_product = '{% url "laboratory:api_reservation_detail" 0%}';
    </script>

    <script type="text/javascript" src="{% static 'js/my_reservations.js' %}"></script>

    <script>
    function filterFunction(dataTableParams,settings){
  var data = formatDataTableParams(dataTableParams, settings);

  data['subfiltrar']=document.getElementById('showAllProducts').checked;

  return data;
}
  document.reservedurl='{% url "api-reservedproduct-list" %}{{labpk}}/'

  datatableElement=createDataTable('#table_id',document.reservedurl, {

     columns: [
            {data: "shelf_object", name: "shelf_object__object__name", title: "Shelf Object", type: "string", visible: true},
            {data: "amount_required", name: "amount_required", title: "Amount Required", type: "string", visible: true},
            {data: "initial_date", name: "initial_date", title: "Initial Date", type: "date", visible: true, "dateformat": "{% get_date_format %}"},
            {data: "final_date", name: "final_date", title: "Final Date", type: "date", visible: true, "dateformat":  "{% get_date_format %}"},
            {data: "status", name: "status", title: "Status", type: "select", visible: true, choices: [['0', 'Requested'], ['1', 'Borrowed'], ['2', 'Denied'],['3','Selected'],['4','Returned']]},
            {data: "action", name: "action", title: "Action", type: "readonly", visible: true},
        ]
    }, addfilter=true, formatDataTableParamsfnc=filterFunction);

    $('#showAllProducts').on('click',function(){
        datatableElement.ajax.reload()
    });

    </script>
{% endblock %}